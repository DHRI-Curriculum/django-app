{% extends 'website/base.html' %}
{% load markdownify static %}


{% block extra_head_material %}
    <link rel="stylesheet" href="{% static 'glossary/css/postit.css' %}">
    <link rel="stylesheet" href="{% static 'workshop/css/frontmatter.css' %}">
{% endblock %}


{% block admin_edit %}
  <a class="text-decoration-none dropdown-item admin-link-django" target="_blank" href="{% url 'admin:index' %}">Django admin</a>
  <a class="text-decoration-none dropdown-item admin-link-edit" target="_blank" href="{% url 'admin:workshop_frontmatter_change' frontmatter.id  %}">Edit frontmatter</a>
  <a class="text-decoration-none dropdown-item admin-link-github" target="_blank" href="https://www.github.com/{{ workshop.parent_repo }}/blob/{{ workshop.parent_branch }}/frontmatter.md">See on GitHub</a>
{% endblock %}


{% block before_content %}
    {% if not request.user.is_authenticated %}
        <div class="w-100 py-5" id="no-login">
            <div class="alert alert-info">Note that you are not logged in. In order to save progress and interact with the workshops, you need to <a href="{% url 'login' %}">login</a> or <a href="{% url 'register' %}">create an account</a>.</div>
        </div>
    {% endif %}
{% endblock %}


{% block hero %}
    <div class="d-flex justify-content-end border-bottom pt-3 mb-3" id="workshop-meta">
        {% if request.user.is_authenticated %}
            <div class="py-2 px-3" id="favorite">
                {% if user_favorited %}
                    <strong>Favorite:</strong> <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg" id="remove-favorite" data-url="/learner/favorite/" data-workshop="{{ workshop.slug }}" data-div="favorite"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" style="pointer-events: none;" /></svg></a>
                {% else %}
                    <strong>Favorite:</strong> <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star" fill="currentColor" xmlns="http://www.w3.org/2000/svg" id="add-favorite" data-url="/learner/favorite/" data-workshop="{{ workshop.slug }}" data-div="favorite"><path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z" style="pointer-events: none;" /></svg>
                {% endif %}
            </div>
        {% endif %}
        <div class="py-2 px-3" id="views">
            <p><strong>Views:</strong> {{ workshop.views }}</p>
        </div>
        <div class="py-2 px-2" id="time_estimated">
            <span class="text-muted small">This workshop is estimated to take {{ frontmatter.estimated_time }} hours to complete.</span>
        </div>
        <div class="py-2 px-3" id="updated">
            <p><strong>Last updated:</strong> {{ workshop.updated }}</p>
        </div>
    </div>

    <div id="hero">
        {% include 'workshop/fragments/frontmatter/hero.html' %}
    </div><!-- /hero -->

{% endblock %}


{% block main %}
  {% if current_authors %}
    <div class="row">
      <div class="col-12">
        <h3>Meet the author{% if current_authors.count > 1 %}s{% endif %}</h3>
      </div>
    {% for c in current_authors %}
          <div class="col-sm-3"><!--left col-->
              <div class="text-center">
                  <img src="{{ c.contributor.profile.image.url }}" class="avatar img-circle img-thumbnail" alt="avatar">
              </div>
          </div>
          <div class="col-sm-9">
              <h4 class="account-heading">{{ c.contributor }}</h4>
              <p class="text-secondary">{{ c.contributor.profile.user.email }}</p>
              {% if c.contributor.profile.bio %}<p>{{ c.contributor.profile.bio }}</p>{% endif %}
              {% if c.contributor.profile.links.count %}
                <p><strong class="mr-2">Personal links</strong>{% for link in c.contributor.profile.personal_links.all %}<a href="{{ link.url }}" class="badge bg-light text-dark mr-1" target="_blank">{{ link.label }}</a>{% endfor %}</p>
                <p><strong class="mr-2">Projects I have worked on</strong>{% for link in c.contributor.profile.project_links.all %}<a href="{{ link.url }}" class="badge bg-light text-dark mr-1" target="_blank">{{ link.label }}</a>{% endfor %}</p>
              {% endif %}
          </div>
    {% endfor %}
    </div>
  {% endif %}

  {% if blurbs %}
    <div class="row mt-5">
      {% for blurb in blurbs %}
        <div class="col-12">
          <h4>Meet your instructor</h4>
          <p class="lead">{{ blurb.text | safe }}</p>
          {% if blurb.user.first_name and blurb.user.last_name %}
            <p>â€” {{ blurb.user.first_name }} {{ blurb.user.last_name }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if frontmatter.prerequisites.count or frontmatter.resources.count %}
    <div class="row mt-5">

      <div class="col-12 pb-2">
        <h3>Before you start</h3>
        <div class="lead mt-4">
          Here is an introduction to the section "Before you start," and something about what it means.
        </div>
        <hr />
      </div>

      <div class="col-12 col-md-6">
        {% if frontmatter.prerequisites.count %}
        <h4>Prerequisites</h4>
        <p style="font-size:1.05rem;">Here is an introductory paragraph about what a prerequisite means. This should go in the new site model probably.</p>
          {% for prerequisite in frontmatter.prerequisites.all %}
            {{ prerequisite }}
          {% endfor %}
        {% endif %}
      </div>

      <div class="col-12 col-md-6">
        {% if frontmatter.resources.count %}
        <h4>Requirements</h4>
        <p style="font-size:1.05rem;">Here is an introductory paragraph about what a requirement means. This should go in the new site model probably.</p>
          {% for resource in frontmatter.resources.all %}
            {{ resource }}
          {% endfor %}
        {% endif %}
      </div>

    </div>
  {% endif %}

  <div class="row mt-5 rounded-sm">
    <div class="col-12 pb-2">
      <h3>Contexts</h3>
      <div class="lead mt-4">
        Here is an introduction to the section "Contexts," and something about what it means.
      </div>
      <hr />
    </div>
    {% if frontmatter.ethical_considerations.count %}
      <div class="col-12 col-xl-4 mt-4 mt-md-2 overflow-hidden">
        <h4>Ethical considerations</h4>
        <hr />
        <p style="font-size:1.05rem;">Here is an introductory paragraph about what ethical considerations mean. It might contain <a href="/library/">a link</a> to more information about why we include information about ethics on this level of the website.</p>
        {% for label in frontmatter.ethical_considerations.all %}
          {{ label | as_string | markdown | safe }}
        {% endfor %}
      </div>
    {% endif %}

    {% if frontmatter.readings.count %}
      <div class="col-12 col-xl-4 mt-4 mt-md-2 overflow-hidden">
        <h4>Readings before you get started</h4>
        <hr />
        <p style="font-size:1.05rem;">Here is an introductory paragraph about what the following readings are. It might contain <a href="/library/">a link</a> to our "library" for the curriculum website, which can contain all kinds of information.</p>
        {% for reading in frontmatter.readings.all %}
          <div class="p-2 my-3 rounded-lg linked-comment">
            <a class="text-decoration-none" target="_blank" href="{{ reading.url }}">
              {{ reading.title }}{% include 'website/fragments/bootstrap-icon.html' with icon="arrow-up-right-circle" %}
            </a>
            {% if reading.annotation %}<div class="small"><strong>Annotation:</strong> {{ reading.annotation | as_string | markdown | safe | striptags }}</div>{% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if frontmatter.projects.count %}
      <div class="col-12 col-xl-4 mt-4 mt-md-2 overflow-hidden">
        <h4>Projects related to {{ workshop.name }}</h4>
        <hr />
        <p style="font-size:1.05rem;">Here is an introductory paragraph about what the following projects are and why they are listed here. It might contain <a href="/library/">a link</a> to our "library" for the curriculum website, which can contain all kinds of information.</p>
        {% for project in frontmatter.projects.all %}
          <div class="p-2 my-3 rounded-lg linked-comment">
            {% if project.url != None %}
              <a class="text-decoration-none" target="_blank" href="{{ project.url }}">
                {{ project.title }}{% include 'website/fragments/bootstrap-icon.html' with icon="arrow-up-right-circle" %}
              </a>
            {% endif %}
            {% if project.annotation %}
              <div class="small"><strong>Annotation:</strong> {{ project.annotation | as_string | markdown | safe | striptags }}</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {% if past_authors or current_reviewers or past_reviewers or current_editors or past_editors %}
    <div class="row my-3 bg-super-light rounded-lg">
      {% if past_authors %}
        <div class="col-12 col-lg-4">
          <div class="border-bottom py-1 my-3"><h4>Contributing Authors</h4></div>
          <div class="py-1 my-1"><h6>Past</h6></div>
          {% for c in past_authors %}
            {% include 'workshop/fragments/frontmatter/collaborator_row.html' %}
          {% endfor %}
        </div>
      {% endif %}

      {% if current_reviewers or past_reviewers %}
        <div class="col-12 col-lg-4">
          <div class="border-bottom py-1 my-3"><h4>Reviewers</h4></div>
          {% if current_reviewers %}
            <div class="py-1 my-1"><h6>Current</h6></div>
            {% for c in current_reviewers %}
              {% include 'workshop/fragments/frontmatter/collaborator_row.html' %}
            {% endfor %}
          {% endif %}
          {% if past_reviewers %}
            <div class="py-1 my-1"><h6>Past</h6></div>
            {% for c in past_reviewers %}
              {% include 'workshop/fragments/frontmatter/collaborator_row.html' %}
            {% endfor %}
          {% endif %}
        </div>
      {% endif %}

      {% if current_editors or past_editors %}
        <div class="col-12 col-lg-4">
          <div class="border-bottom py-1 my-3"><h4>Editors</h4></div>
          {% if current_editors %}
            <div class="py-1 my-1"><h6>Current</h6></div>
            {% for c in current_editors %}
              {% include 'workshop/fragments/frontmatter/collaborator_row.html' %}
            {% endfor %}
          {% endif %}
          {% if past_editors %}
            <div class="py-1 my-1"><h6>Past</h6></div>
            {% for c in past_editors %}
              {% include 'workshop/fragments/frontmatter/collaborator_row.html' %}
            {% endfor %}
          {% endif %}
        </div>
      {% endif %}

    </div>
  {% endif %}
{% endblock %}


{% block javascript %}
  <script>
    var additional_terms = ''
      {% for term in all_terms %}
        {% if forloop.counter > 6 %}
            additional_terms += `{% include 'glossary/fragments/postit.html' %}`;
        {% endif %}
      {% endfor %}
    more_terms_button = document.querySelector('a[data-target="#moreTerms"]')
    if (more_terms_button) {
      more_terms_button.addEventListener('click', () => {
        more_terms_button.ariaExpanded = true
        document.querySelector('#moreBtn').classList.add('d-none');
        document.querySelector('#moreBtn').classList.remove('d-flex');
        document.querySelector('#moreTerms').innerHTML += additional_terms;
      });
    }
  </script>
  <script src="{% static 'workshop/js/navbar.js' %}" crossorigin="anonymous"></script>
  <script src="{% static 'workshop/js/favorite.js' %}" crossorigin="anonymous"></script>
{% endblock %}