{% load markdownify %}
{% load static %}


<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Digital Humanities Research Institute - Curriculum Website</title>
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'website/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'website/css/bootstrap-style.min.css' %}">
    <link rel="stylesheet" href="{% static 'website/css/icons.css' %}">

    <style type="text/css">
        /*
        ::-webkit-scrollbar {
            background-color: #F5F5F5;
            width: 7px;
        }
        */
    </style>

    <script type="text/javascript">
      // A CSRF token is required when making post requests in Django
      // To be used for making AJAX requests
      window.CSRF_TOKEN = "{{ csrf_token }}";
    </script>

  </head>
  <body>

    {% include "website/navbar.html" %}

    <div id="content" class="container-fluid mx-auto px-5 py-4">

        <div class="row">

            <div class="col-12">

                <h1>Preview of {{ type }} for {{ workshop.name }}</h1>

                <div class="py-3">
                    <a target="_blank" href="https://www.github.com/{{ workshop.parent_repo }}/blob/{{ workshop.parent_branch }}/{{ files | get_item:type }}" class="text-decoration-none">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-code" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 1h5v1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6h1v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2z"/>
                        <path d="M9 4.5V1l5 5h-3.5A1.5 1.5 0 0 1 9 4.5z"/>
                        <path fill-rule="evenodd" d="M8.646 6.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 9 8.646 7.354a.5.5 0 0 1 0-.708zm-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 9l1.647-1.646a.5.5 0 0 0 0-.708z"/>
                        </svg><span class="ml-1">See on GitHub</span>
                    </a>
                </div>

                <div class="row g-3 py-4">
                    <h2 class="text-muted">Preview markdown</h2>
                    <hr />
                    <div class="col-12 py-2 shadow lesson-text overflow-auto border" style="max-height:500px;min-height:500px;">
                        {{ markdown_text | nl2br | safe }}
                    </div>
                </div>

                <div class="row g-3 py-4">
                    <h2 class="text-muted">Preview parsed data</h2>
                    <div class="col-12 shadow overflow-auto border" style="max-height:500px;min-height:500px;">
                        {% if type == 'frontmatter' or type == 'praxis' %}
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="border-top-0">key</th>
                                        <th scope="col" class="border-top-0 col-5" style="min-width:500px;">value</th>
                                        <th scope="col" class="border-top-0" style="min-width:500px;">value (rendered)</th>
                                        <th scope="col" class="border-top-0">type</th>
                                    </tr>
                                </thead>
                                {% for key, value in sections.items %}
                                    <tr>
                                        <th scope="row">{{ key }}:</td>
                                        <td>{{ value }}</td>
                                        {% if sections|is_list:key %}
                                            <td>
                                                <ul>
                                                    {% for val in value %}
                                                        <li>{{ val | as_string | markdown | safe }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </td>
                                        {% else %}
                                            <td>{{ value | as_string | markdown | safe }}</td>
                                        {% endif %}
                                        <td style="min-width:150px;">{{ sections|get_item_type:key }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        {% elif type == 'lessons' %}
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="border-top-0" style="min-width:200px;">title</th>
                                        <th scope="col" class="border-top-0" style="min-width:500px;">text</th>
                                        <th scope="col" class="border-top-0" style="min-width:500px;">text (rendered)</th>
                                        <th scope="col" class="border-top-0" style="min-width:300px;">challenge</th>
                                        <th scope="col" class="border-top-0" style="min-width:300px;">challenge (rendered)</th>
                                        <th scope="col" class="border-top-0" style="min-width:300px;">solution</th>
                                        <th scope="col" class="border-top-0" style="min-width:300px;">solution (rendered)</th>
                                    </tr>
                                </thead>
                                {% for key in sections %}
                                    <tr>
                                        <th scope="row">{{ forloop.counter }}. {% get_from_tuple key 0 'title' %}:</td>
                                        <td class="preview-text">{% get_from_tuple key 0 'text' %}</td>
                                        <td class="preview-text">
                                            <h1>{% get_from_tuple key 1 'title' %}</h1>
                                            {% get_from_tuple key 1 'text' %}
                                        </td>
                                        <td class="preview-text">{% get_from_tuple key 0 'challenge' %}</td>
                                        <td class="preview-text">{% get_from_tuple key 1 'challenge' %}</td>
                                        <td class="preview-text">{% get_from_tuple key 0 'solution' %}</td>
                                        <td class="preview-text">{% get_from_tuple key 1 'solution' %}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        {% endif %}

                    </div>
                </div>

            </div>
        </div>

    </div>


    <div id="footer" class="container mx-auto">
      <footer class="pt-4 my-5 border-top zen-hideaway">
        {% include 'website/footer.html' %}
      </footer>
    </div>

    <!-- bootstrap v5.0-alpha1 -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
    <script src="{% static 'website/js/sitewide.js' %}"></script>
    {% block javascript %}
    {% endblock %}
  </body>
</html>
